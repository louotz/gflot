'use strict';(function(v){var m,w,x,n=Object.prototype.hasOwnProperty;v.plot.plugins.push({init:function(p,k){k=k.Canvas;null==m&&(w=k.prototype.getTextInfo,x=k.prototype.addText,m=k.prototype.render);k.prototype.render=function(){if(!p.getOptions().canvas)return m.call(this);var d=this.context,e=this._textCache;d.save();d.textBaseline="middle";for(var b in e)if(n.call(e,b)){var c=e[b],a;for(a in c)if(n.call(c,a)){var g=c[a],h=!0,l;for(l in g)if(n.call(g,l)){var f=g[l],q=f.positions,y=f.lines;h&&
(d.fillStyle=f.font.color,d.font=f.font.definition,h=!1);f=0;for(var r;r=q[f];f++)if(r.active)for(var t=0,u;u=r.lines[t];t++)d.fillText(y[t].text,u[0],u[1]);else q.splice(f--,1);0==q.length&&delete g[l]}}}d.restore()};k.prototype.getTextInfo=function(d,e,b,c,a){if(!p.getOptions().canvas)return w.call(this,d,e,b,c,a);e=""+e;var g="object"===typeof b?b.style+" "+b.variant+" "+b.weight+" "+b.size+"px "+b.family:b;c=this._textCache[d];null==c&&(c=this._textCache[d]={});var h=c[g];null==h&&(h=c[g]={});
a=h[e];if(null==a){c=this.context;"object"!==typeof b&&(a=v("\x3cdiv\x3e\x26nbsp;\x3c/div\x3e").css("position","absolute").addClass("string"===typeof b?b:null).appendTo(this.getTextLayer(d)),b={lineHeight:a.height(),style:a.css("font-style"),variant:a.css("font-variant"),weight:a.css("font-weight"),family:a.css("font-family"),color:a.css("color")},b.size=a.css("line-height",1).height(),a.remove());g=b.style+" "+b.variant+" "+b.weight+" "+b.size+"px "+b.family;a=h[e]={width:0,height:0,positions:[],
lines:[],font:{definition:g,color:b.color}};c.save();c.font=g;e=(e+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(d=0;d<e.length;++d)h=e[d],g=c.measureText(h),a.width=Math.max(g.width,a.width),a.height+=b.lineHeight,a.lines.push({text:h,width:g.width,height:b.lineHeight});c.restore()}return a};k.prototype.addText=function(d,e,b,c,a,g,h,l,f){if(!p.getOptions().canvas)return x.call(this,d,e,b,c,a,g,h,l,f);a=this.getTextInfo(d,c,a,g,h);c=a.positions;d=a.lines;b+=a.height/d.length/2;b="middle"==
f?Math.round(b-a.height/2):"bottom"==f?Math.round(b-a.height):Math.round(b);window.opera&&12>window.opera.version().split(".")[0]&&(b-=2);for(f=0;a=c[f];f++)if(a.x==e&&a.y==b){a.active=!0;return}a={active:!0,lines:[],x:e,y:b};c.push(a);for(f=0;c=d[f];f++)"center"==l?a.lines.push([Math.round(e-c.width/2),b]):"right"==l?a.lines.push([Math.round(e-c.width),b]):a.lines.push([Math.round(e),b]),b+=c.height}},options:{canvas:!0},name:"canvas",version:"1.0"})})(jQuery);
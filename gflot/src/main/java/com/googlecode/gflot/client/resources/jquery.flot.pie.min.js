'use strict';(function(I){I.plot.plugins.push({init:function(r){function K(b,c){function g(){e.clearRect(0,0,k,m);G.children().filter(".pieLabel, .pieLabelBackground").remove()}function l(){var a=d.series.pie.shadow.left,n=d.series.pie.shadow.top,q=d.series.pie.shadow.alpha,z=1<d.series.pie.radius?d.series.pie.radius:x*d.series.pie.radius;if(!(z>=k/2-a||z*d.series.pie.tilt>=m/2-n||10>=z)){e.save();e.translate(a,n);e.globalAlpha=q;e.fillStyle="#000";e.translate(p,H);e.scale(1,d.series.pie.tilt);for(a=
1;10>=a;a++)e.beginPath(),e.arc(0,0,z,0,2*Math.PI,!1),e.fill(),z-=a;e.restore()}}function h(){function a(B,J,D){0>=B||isNaN(B)||(D?e.fillStyle=J:(e.strokeStyle=J,e.lineJoin="round"),e.beginPath(),1E-9<Math.abs(B-2*Math.PI)&&e.moveTo(0,0),e.arc(0,0,z,t,t+B/2,!1),e.arc(0,0,z,t+B/2,t+B,!1),e.closePath(),t+=B,D?e.fill():e.stroke())}function n(){for(var B=q,J=1<d.series.pie.label.radius?d.series.pie.label.radius:x*d.series.pie.label.radius,D=0;D<f.length;++D){if(f[D].percent>=100*d.series.pie.label.threshold){var u=
f[D];var E=B,y=D;if(0==u.data[0][1])u=!0;else{var A=d.legend.labelFormatter;var v=d.series.pie.label.formatter;A=A?A(u.label,u):u.label;v&&(A=v(A,u));v=(E+u.angle+E)/2;E=p+Math.round(Math.cos(v)*J);v=H+Math.round(Math.sin(v)*J)*d.series.pie.tilt;G.append("\x3cspan class\x3d'pieLabel' id\x3d'pieLabel"+y+"' style\x3d'position:absolute;top:"+v+"px;left:"+E+"px;'\x3e"+A+"\x3c/span\x3e");y=G.children("#pieLabel"+y);A=v-y.height()/2;v=E-y.width()/2;y.css("top",A);y.css("left",v);0<0-A||0<0-v||0>m-(A+y.height())||
0>k-(v+y.width())?u=!1:(0!=d.series.pie.label.background.opacity&&(E=d.series.pie.label.background.color,null==E&&(E=u.color),u="top:"+A+"px;left:"+v+"px;",I("\x3cdiv class\x3d'pieLabelBackground' style\x3d'position:absolute;width:"+y.width()+"px;height:"+y.height()+"px;"+u+"background-color:"+E+";'\x3e\x3c/div\x3e").css("opacity",d.series.pie.label.background.opacity).insertBefore(y)),u=!0)}if(!u)return!1}B+=f[D].angle}return!0}var q=Math.PI*d.series.pie.startAngle,z=1<d.series.pie.radius?d.series.pie.radius:
x*d.series.pie.radius;e.save();e.translate(p,H);e.scale(1,d.series.pie.tilt);e.save();for(var t=q,F=0;F<f.length;++F)f[F].startAngle=t,a(f[F].angle,f[F].color,!0);e.restore();if(0<d.series.pie.stroke.width){e.save();e.lineWidth=d.series.pie.stroke.width;t=q;for(F=0;F<f.length;++F)a(f[F].angle,d.series.pie.stroke.color,!1);e.restore()}M(e);e.restore();return d.series.pie.label.show?n():!0}if(G){var k=b.getPlaceholder().width(),m=b.getPlaceholder().height(),w=G.children().filter(".legend").children().width()||
0;e=c;L=!1;x=Math.min(k,m/d.series.pie.tilt)/2;H=m/2+d.series.pie.offset.top;p=k/2;"auto"==d.series.pie.offset.left?(p=d.legend.position.match("w")?p+w/2:p-w/2,p<x?p=x:p>k-x&&(p=k-x)):p+=d.series.pie.offset.left;var f=b.getData();c=0;do 0<c&&(x*=.95),c+=1,g(),.8>=d.series.pie.tilt&&l();while(!h()&&10>c);10<=c&&(g(),G.prepend("\x3cdiv class\x3d'error'\x3eCould not draw pie with labels contained inside canvas\x3c/div\x3e"));b.setSeries&&b.insertLegend&&(b.setSeries(f),b.insertLegend())}}function M(b){if(0<
d.series.pie.innerRadius){b.save();var c=1<d.series.pie.innerRadius?d.series.pie.innerRadius:x*d.series.pie.innerRadius;b.globalCompositeOperation="destination-out";b.beginPath();b.fillStyle=d.series.pie.stroke.color;b.arc(0,0,c,0,2*Math.PI,!1);b.fill();b.closePath();b.restore();b.save();b.beginPath();b.strokeStyle=d.series.pie.stroke.color;b.arc(0,0,c,0,2*Math.PI,!1);b.stroke();b.closePath();b.restore()}}function Q(b){N("plothover",b)}function R(b){N("plotclick",b)}function N(b,c){var g=r.offset(),
l=parseInt(c.pageX-g.left);g=parseInt(c.pageY-g.top);a:{var h=r.getData(),k=r.getOptions();k=1<k.series.pie.radius?k.series.pie.radius:x*k.series.pie.radius;for(var m,w,f=0;f<h.length;++f){var a=h[f];if(a.pie.show){e.save();e.beginPath();e.moveTo(0,0);e.arc(0,0,k,a.startAngle,a.startAngle+a.angle/2,!1);e.arc(0,0,k,a.startAngle+a.angle/2,a.startAngle+a.angle,!1);e.closePath();m=l-p;w=g-H;if(e.isPointInPath){if(e.isPointInPath(l-p,g-H)){e.restore();l={datapoint:[a.percent,a.data],dataIndex:0,series:a,
seriesIndex:f};break a}}else{var n=[[0,0],[k*Math.cos(a.startAngle),k*Math.sin(a.startAngle)],[k*Math.cos(a.startAngle+a.angle/4),k*Math.sin(a.startAngle+a.angle/4)],[k*Math.cos(a.startAngle+a.angle/2),k*Math.sin(a.startAngle+a.angle/2)],[k*Math.cos(a.startAngle+a.angle/1.5),k*Math.sin(a.startAngle+a.angle/1.5)],[k*Math.cos(a.startAngle+a.angle),k*Math.sin(a.startAngle+a.angle)]];m=[m,w];w=!1;for(var q=-1,z=n.length,t=z-1;++q<z;t=q)(n[q][1]<=m[1]&&m[1]<n[t][1]||n[t][1]<=m[1]&&m[1]<n[q][1])&&m[0]<
(n[t][0]-n[q][0])*(m[1]-n[q][1])/(n[t][1]-n[q][1])+n[q][0]&&(w=!w);if(w){e.restore();l={datapoint:[a.percent,a.data],dataIndex:0,series:a,seriesIndex:f};break a}}e.restore()}}l=null}if(d.grid.autoHighlight)for(g=0;g<C.length;++g)h=C[g],h.auto!=b||l&&h.series==l.series||(h=h.series,null==h&&(C=[],r.triggerRedrawOverlay()),h=O(h),-1!=h&&(C.splice(h,1),r.triggerRedrawOverlay()));l&&(g=l.series,h=O(g),-1==h?(C.push({series:g,auto:b}),r.triggerRedrawOverlay()):b||(C[h].auto=!1));G.trigger(b,[{pageX:c.pageX,
pageY:c.pageY},l])}function O(b){for(var c=0;c<C.length;++c)if(C[c].series==b)return c;return-1}var P=null,G=null,d=null,x=null,p=null,H=null,L=!1,e=null,C=[];r.hooks.processOptions.push(function(b,c){c.series.pie.show&&(c.grid.show=!1,"auto"==c.series.pie.label.show&&(c.series.pie.label.show=c.legend.show?!1:!0),"auto"==c.series.pie.radius&&(c.series.pie.radius=c.series.pie.label.show?.75:1),1<c.series.pie.tilt?c.series.pie.tilt=1:0>c.series.pie.tilt&&(c.series.pie.tilt=0))});r.hooks.bindEvents.push(function(b,
c){b=b.getOptions();b.series.pie.show&&(b.grid.hoverable&&c.unbind("mousemove").mousemove(Q),b.grid.clickable&&c.unbind("click").click(R))});r.hooks.processDatapoints.push(function(b,c,g,l){if(b.getOptions().series.pie.show&&!L){L=!0;P=b.getCanvas();G=I(P).parent();d=b.getOptions();c=b.setData;g=b.getData();for(var h=l=0,k=0,m=d.series.pie.combine.color,w=[],f=0;f<g.length;++f){var a=g[f].data;I.isArray(a)&&1==a.length&&(a=a[0]);I.isArray(a)?!isNaN(parseFloat(a[1]))&&isFinite(a[1])?a[1]=+a[1]:a[1]=
0:a=!isNaN(parseFloat(a))&&isFinite(a)?[1,+a]:[1,0];g[f].data=[a]}for(f=0;f<g.length;++f)l+=g[f].data[0][1];for(f=0;f<g.length;++f)a=g[f].data[0][1],a/l<=d.series.pie.combine.threshold&&(h+=a,k++,m||(m=g[f].color));for(f=0;f<g.length;++f)a=g[f].data[0][1],(2>k||a/l>d.series.pie.combine.threshold)&&w.push(I.extend(g[f],{data:[[1,a]],color:g[f].color,label:g[f].label,angle:a*Math.PI*2/l,percent:a/(l/100)}));1<k&&w.push({data:[[1,h]],color:m,label:d.series.pie.combine.label,angle:h*Math.PI*2/l,percent:h/
(l/100)});c.call(b,w)}});r.hooks.drawOverlay.push(function(b,c){if(b.getOptions().series.pie.show){b=b.getOptions();var g=1<b.series.pie.radius?b.series.pie.radius:x*b.series.pie.radius;c.save();c.translate(p,H);c.scale(1,b.series.pie.tilt);for(var l=0;l<C.length;++l){var h=C[l].series;0>=h.angle||isNaN(h.angle)||(c.fillStyle="rgba(255, 255, 255, "+b.series.pie.highlight.opacity+")",c.beginPath(),1E-9<Math.abs(h.angle-2*Math.PI)&&c.moveTo(0,0),c.arc(0,0,g,h.startAngle,h.startAngle+h.angle/2,!1),c.arc(0,
0,g,h.startAngle+h.angle/2,h.startAngle+h.angle,!1),c.closePath(),c.fill())}M(c);c.restore()}});r.hooks.draw.push(function(b,c){b.getOptions().series.pie.show&&K(b,c)})},options:{series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(r,K){return"\x3cdiv style\x3d'font-size:x-small;text-align:center;padding:2px;color:"+K.color+";'\x3e"+r+"\x3cbr/\x3e"+Math.round(K.percent)+
"%\x3c/div\x3e"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}},name:"pie",version:"1.1"})})(jQuery);
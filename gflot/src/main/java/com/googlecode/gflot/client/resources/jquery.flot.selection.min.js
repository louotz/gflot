'use strict';(function(p){p.plot.plugins.push({init:function(f){function v(b){e.active&&(w(b),f.getPlaceholder().trigger("plotselecting",[u()]))}function x(b){1===b.which&&(document.body.focus(),void 0!==document.onselectstart&&null==q.onselectstart&&(q.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==q.ondrag&&(q.ondrag=document.ondrag,document.ondrag=function(){return!1}),y(e.first,b),e.active=!0,r=function(a){r=null;void 0!==document.onselectstart&&
(document.onselectstart=q.onselectstart);void 0!==document.ondrag&&(document.ondrag=q.ondrag);e.active=!1;w(a);t()?z():(f.getPlaceholder().trigger("plotunselected",[]),f.getPlaceholder().trigger("plotselecting",[null]))},p(document).one("mouseup",r))}function u(){if(!t()||!e.show)return null;var b={},a={x:e.first.x,y:e.first.y},g={x:e.second.x,y:e.second.y};"x"===n(f)&&(a.y=0,g.y=f.height());"y"===n(f)&&(a.x=0,g.x=f.width());p.each(f.getAxes(),function(m,c){if(c.used){var d=c.c2p(a[c.direction]);
c=c.c2p(g[c.direction]);b[m]={from:Math.min(d,c),to:Math.max(d,c)}}});return b}function z(){var b=u();f.getPlaceholder().trigger("plotselected",[b]);b.xaxis&&b.yaxis&&f.getPlaceholder().trigger("selected",[{x1:b.xaxis.from,y1:b.yaxis.from,x2:b.xaxis.to,y2:b.yaxis.to}])}function n(b){b=b.getOptions();return"smart"===b.selection.mode?e.currentMode:b.selection.mode}function y(b,a){var g=f.getPlaceholder().offset(),m=f.getPlotOffset(),c=a.pageX-g.left-m.left,d=f.width();b.x=0>c?0:c>d?d:c;a=a.pageY-g.top-
m.top;g=f.height();b.y=0>a?0:a>g?g:a;b!==e.first&&e.first&&(a=b.y-e.first.y,e.currentMode=Math.abs(b.x-e.first.x)<A?"y":Math.abs(a)<A?"x":"xy");"y"===n(f)&&(b.x=b===e.first?0:f.width());"x"===n(f)&&(b.y=b===e.first?0:f.height())}function w(b){null!=b.pageX&&(y(e.second,b),t()?(e.show=!0,f.triggerRedrawOverlay()):B(!0))}function B(b){e.show&&(e.show=!1,e.currentMode="",f.triggerRedrawOverlay(),b||f.getPlaceholder().trigger("plotunselected",[]))}function C(b,a){var g=f.getAxes(),m;for(m in g){var c=
g[m];if(c.direction===a){var d=a+c.n+"axis";b[d]||1!==c.n||(d=a+"axis");if(b[d]){var h=b[d].from;var k=b[d].to;break}}}b[d]||(c="x"===a?f.getXAxes()[0]:f.getYAxes()[0],h=b[a+"1"],k=b[a+"2"]);null!=h&&null!=k&&h>k&&(b=h,h=k,k=b);return{from:h,to:k,axis:c}}function t(){var b=f.getOptions().selection.minSize;return Math.abs(e.second.x-e.first.x)>=b&&Math.abs(e.second.y-e.first.y)>=b}var e={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,currentMode:"xy",active:!1},A=p.plot.uiConstants.SNAPPING_CONSTANT,
q={},r=null;f.clearSelection=B;f.setSelection=function(b,a){if("y"===n(f))e.first.x=0,e.second.x=f.width();else{var g=C(b,"x");e.first.x=g.axis.p2c(g.from);e.second.x=g.axis.p2c(g.to)}"x"===n(f)?(e.first.y=0,e.second.y=f.height()):(g=C(b,"y"),e.first.y=g.axis.p2c(g.from),e.second.y=g.axis.p2c(g.to));e.show=!0;f.triggerRedrawOverlay();!a&&t()&&z()};f.getSelection=u;f.hooks.bindEvents.push(function(b,a){null!=b.getOptions().selection.mode&&(a.mousemove(v),a.mousedown(x))});f.hooks.drawOverlay.push(function(b,
a){if(e.show&&t()){var g=b.getPlotOffset(),m=b.getOptions();a.save();a.translate(g.left,g.top);g=p.color.parse(m.selection.color);a.strokeStyle=g.scale("a",1).toString();a.lineWidth=1;a.lineJoin=m.selection.shape;a.fillStyle=g.scale("a",.4).toString();var c=Math.min(e.first.x,e.second.x)+.5;m=c;var d=Math.min(e.first.y,e.second.y)+.5;g=d;var h=Math.abs(e.second.x-e.first.x)-1,k=Math.abs(e.second.y-e.first.y)-1;"x"===n(b)&&(k+=d,d=0);"y"===n(b)&&(h+=c,c=0);a.fillRect(0,0,b.width(),b.height());a.clearRect(c,
d,h,k);b=n(b);var l=Math.max(0,Math.min(15,h/2-2,k/2-2));a.fillStyle="#ffffff";"xy"===b&&(a.beginPath(),a.moveTo(c,d+l),a.lineTo(c-3,d+l),a.lineTo(c-3,d-3),a.lineTo(c+l,d-3),a.lineTo(c+l,d),a.lineTo(c,d),a.closePath(),a.moveTo(c,d+k-l),a.lineTo(c-3,d+k-l),a.lineTo(c-3,d+k+3),a.lineTo(c+l,d+k+3),a.lineTo(c+l,d+k),a.lineTo(c,d+k),a.closePath(),a.moveTo(c+h,d+l),a.lineTo(c+h+3,d+l),a.lineTo(c+h+3,d-3),a.lineTo(c+h-l,d-3),a.lineTo(c+h-l,d),a.lineTo(c+h,d),a.closePath(),a.moveTo(c+h,d+k-l),a.lineTo(c+
h+3,d+k-l),a.lineTo(c+h+3,d+k+3),a.lineTo(c+h-l,d+k+3),a.lineTo(c+h-l,d+k),a.lineTo(c+h,d+k),a.closePath(),a.stroke(),a.fill());c=m;d=g;"x"===b&&(a.beginPath(),a.moveTo(c,d+15),a.lineTo(c,d-15),a.lineTo(c-3,d-15),a.lineTo(c-3,d+15),a.closePath(),a.moveTo(c+h,d+15),a.lineTo(c+h,d-15),a.lineTo(c+h+3,d-15),a.lineTo(c+h+3,d+15),a.closePath(),a.stroke(),a.fill());"y"===b&&(a.beginPath(),a.moveTo(c-15,d),a.lineTo(c+15,d),a.lineTo(c+15,d-3),a.lineTo(c-15,d-3),a.closePath(),a.moveTo(c-15,d+k),a.lineTo(c+
15,d+k),a.lineTo(c+15,d+k+3),a.lineTo(c-15,d+k+3),a.closePath(),a.stroke(),a.fill());a.restore()}});f.hooks.shutdown.push(function(b,a){a.unbind("mousemove",v);a.unbind("mousedown",x);r&&p(document).unbind("mouseup",r)})},options:{selection:{mode:null,color:"#888888",shape:"round",minSize:5}},name:"selection",version:"1.1"})})(jQuery);
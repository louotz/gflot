'use strict';(function(n){n.plot.plugins.push({init:function(d){function t(a){b.active&&(u(a),d.getPlaceholder().trigger("plotselecting",[r()]))}function v(a){1==a.which&&(document.body.focus(),void 0!==document.onselectstart&&null==l.onselectstart&&(l.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==l.ondrag&&(l.ondrag=document.ondrag,document.ondrag=function(){return!1}),w(b.first,a),b.active=!0,p=function(c){p=null;void 0!==document.onselectstart&&
(document.onselectstart=l.onselectstart);void 0!==document.ondrag&&(document.ondrag=l.ondrag);b.active=!1;u(c);q()?x():(d.getPlaceholder().trigger("plotunselected",[]),d.getPlaceholder().trigger("plotselecting",[null]))},n(document).one("mouseup",p))}function r(){if(!q()||!b.show)return null;var a={},c=b.first,g=b.second;n.each(d.getAxes(),function(e,f){if(f.used){var h=f.c2p(c[f.direction]);f=f.c2p(g[f.direction]);a[e]={from:Math.min(h,f),to:Math.max(h,f)}}});return a}function x(){var a=r();d.getPlaceholder().trigger("plotselected",
[a]);a.xaxis&&a.yaxis&&d.getPlaceholder().trigger("selected",[{x1:a.xaxis.from,y1:a.yaxis.from,x2:a.xaxis.to,y2:a.yaxis.to}])}function w(a,c){var g=d.getOptions(),e=d.getPlaceholder().offset(),f=d.getPlotOffset(),h=c.pageX-e.left-f.left,k=d.width();a.x=0>h?0:h>k?k:h;c=c.pageY-e.top-f.top;e=d.height();a.y=0>c?0:c>e?e:c;"y"==g.selection.mode&&(a.x=a==b.first?0:d.width());"x"==g.selection.mode&&(a.y=a==b.first?0:d.height())}function u(a){null!=a.pageX&&(w(b.second,a),q()?(b.show=!0,d.triggerRedrawOverlay()):
y(!0))}function y(a){b.show&&(b.show=!1,d.triggerRedrawOverlay(),a||d.getPlaceholder().trigger("plotunselected",[]))}function z(a,c){var g=d.getAxes(),e;for(e in g){var f=g[e];if(f.direction==c){var h=c+f.n+"axis";a[h]||1!=f.n||(h=c+"axis");if(a[h]){var k=a[h].from;var m=a[h].to;break}}}a[h]||(f="x"==c?d.getXAxes()[0]:d.getYAxes()[0],k=a[c+"1"],m=a[c+"2"]);null!=k&&null!=m&&k>m&&(a=k,k=m,m=a);return{from:k,to:m,axis:f}}function q(){var a=d.getOptions().selection.minSize;return Math.abs(b.second.x-
b.first.x)>=a&&Math.abs(b.second.y-b.first.y)>=a}var b={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},l={},p=null;d.clearSelection=y;d.setSelection=function(a,c){var g=d.getOptions();if("y"==g.selection.mode)b.first.x=0,b.second.x=d.width();else{var e=z(a,"x");b.first.x=e.axis.p2c(e.from);b.second.x=e.axis.p2c(e.to)}"x"==g.selection.mode?(b.first.y=0,b.second.y=d.height()):(e=z(a,"y"),b.first.y=e.axis.p2c(e.from),b.second.y=e.axis.p2c(e.to));b.show=!0;d.triggerRedrawOverlay();!c&&q()&&x()};
d.getSelection=r;d.hooks.bindEvents.push(function(a,c){null!=a.getOptions().selection.mode&&(c.mousemove(t),c.mousedown(v))});d.hooks.drawOverlay.push(function(a,c){if(b.show&&q()){var g=a.getPlotOffset();a=a.getOptions();c.save();c.translate(g.left,g.top);g=n.color.parse(a.selection.color);c.strokeStyle=g.scale("a",.8).toString();c.lineWidth=1;c.lineJoin=a.selection.shape;c.fillStyle=g.scale("a",.4).toString();g=Math.min(b.first.x,b.second.x)+.5;a=Math.min(b.first.y,b.second.y)+.5;var e=Math.abs(b.second.x-
b.first.x)-1,f=Math.abs(b.second.y-b.first.y)-1;c.fillRect(g,a,e,f);c.strokeRect(g,a,e,f);c.restore()}});d.hooks.shutdown.push(function(a,c){c.unbind("mousemove",t);c.unbind("mousedown",v);p&&n(document).unbind("mouseup",p)})},options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})})(jQuery);